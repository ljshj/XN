package com.bgood.xn.ui.user.account;import java.util.Timer;import java.util.TimerTask;import org.json.JSONArray;import org.json.JSONException;import org.json.JSONObject;import android.content.Context;import android.content.Intent;import android.os.Bundle;import android.text.TextUtils;import android.view.KeyEvent;import android.view.View;import android.view.View.OnClickListener;import android.view.inputmethod.InputMethodManager;import android.widget.Button;import android.widget.CheckBox;import android.widget.CompoundButton;import android.widget.CompoundButton.OnCheckedChangeListener;import android.widget.EditText;import android.widget.LinearLayout;import android.widget.TextView;import android.widget.Toast;import com.bgood.xn.R;import com.bgood.xn.bean.WeiQiangBean;import com.bgood.xn.bean.WeiQiangBean.WeiqiangActionType;import com.bgood.xn.network.BaseNetWork.ReturnCode;import com.bgood.xn.network.BaseNetWork;import com.bgood.xn.network.http.HttpRequestInfo;import com.bgood.xn.network.http.HttpResponseInfo;import com.bgood.xn.network.http.HttpRequestAsyncTask.TaskListenerWithState;import com.bgood.xn.network.http.HttpResponseInfo.HttpTaskState;import com.bgood.xn.network.request.UserCenterRequest;import com.bgood.xn.network.request.WeiqiangRequest;import com.bgood.xn.ui.base.BaseActivity;import com.bgood.xn.ui.weiqiang.WeiqiangActivity;import com.bgood.xn.utils.ToolUtils;import com.bgood.xn.utils.WindowUtil;import com.bgood.xn.view.BToast;import com.bgood.xn.view.dialog.BGDialog;import com.bgood.xn.widget.TitleBar;/*** *  * @todo:注册界面 * @date:2014-11-28 下午5:37:19 * @author:hg_liuzl@163.com */public class RegisterActivity extends BaseActivity implements TaskListenerWithState{	private EditText m_phoneEt = null; // 手机号码	private CheckBox m_checkCb = null;	private TextView m_ruleTv = null;	private LinearLayout m_doneLl = null; // 完成	private String phone = "";	@Override	protected void onCreate(Bundle savedInstanceState)	{		super.onCreate(savedInstanceState);		setContentView(R.layout.layout_register);		(new TitleBar(mActivity)).initTitleBar("注册");		findView();	}	/**	 * 控件初始化方法	 */	private void findView()	{		m_phoneEt = (EditText) findViewById(R.id.register_et_phone);		m_checkCb = (CheckBox) findViewById(R.id.register_cb_check);		m_ruleTv = (TextView) findViewById(R.id.register_tv_rule);		findViewById(R.id.register_ll_done).setOnClickListener(new OnClickListener()		{			@Override			public void onClick(View v)			{				checkInfo();			}		});	}	/**	 * 检查用户信息方法	 */	private void checkInfo()	{		// 用户手机号码查询		phone = m_phoneEt.getText().toString().trim();		if (TextUtils.isEmpty(phone))		{			BToast.show(mActivity, "请输入手机号码");			return;		}else{			createProtocolDialog();		}		//		else if (!ToolUtils.isTelephone(phone)){//			BToast.show(mActivity, "请输入正确的手机号码");//			return;//		} else if(!m_checkCb.isChecked()){//			BToast.show(mActivity, "请阅读产品协议");//			return;//		}else{//			UserCenterRequest.getInstance().requestVerifyCode(this, mActivity, phone);//		}	}	@Override	public void onTaskOver(HttpRequestInfo request, HttpResponseInfo info) {		if(info.getState() == HttpTaskState.STATE_OK){			BaseNetWork bNetWork = info.getmBaseNetWork();			JSONObject body = bNetWork.getBody();			if(bNetWork.getReturnCode() == ReturnCode.RETURNCODE_OK){				String verfy = body.optString("verfy");				Intent intent = new Intent(this, RegisterCodeActivity.class);				intent.putExtra("verfy", verfy);				intent.putExtra("phone", phone);				startActivity(intent);			}else if(bNetWork.getReturnCode() == ReturnCode.RETURNCODE_NUM_EXIST){				BToast.show(mActivity, "该手机号已经注册！");			}else{				BToast.show(mActivity, "获取验证码失败！");			}		}	}			/**	 * 	 * @todo:使用协议	 * @date:2015-1-24 上午10:47:52	 * @author:hg_liuzl@163.com	 * @params:	 */	private void createProtocolDialog() {		@SuppressWarnings("deprecation")		int screenWidth = (int) (mActivity.getWindowManager().getDefaultDisplay().getWidth()*0.6); // 屏幕宽		int screenHeight = (int) (mActivity.getWindowManager().getDefaultDisplay().getHeight()*0.6); // 屏幕高		final BGDialog dialog = new BGDialog(mActivity,R.style.dialog_no_thing,screenWidth, screenHeight);		View vProtocol = inflater.inflate(R.layout.dialog_protocol_layout, null);		vProtocol.findViewById(R.id.btn_protocol).setOnClickListener(new OnClickListener() {						@Override			public void onClick(View v) {				dialog.dismiss();				UserCenterRequest.getInstance().requestVerifyCode(RegisterActivity.this, mActivity, phone);			}		});				vProtocol.findViewById(R.id.btn_dis_argee).setOnClickListener(new OnClickListener() {						@Override			public void onClick(View v) {				dialog.dismiss();			}		});				dialog.setCancelable(true);		dialog.showDialog(vProtocol);	}		@Override	public boolean onKeyDown(int keyCode, KeyEvent event) {		if(keyCode == KeyEvent.KEYCODE_BACK){			return true;		}		return super.onKeyDown(keyCode, event);	}}