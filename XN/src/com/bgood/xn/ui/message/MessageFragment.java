package com.bgood.xn.ui.message;import java.util.ArrayList;import android.app.Activity;import android.content.Intent;import android.os.Bundle;import android.support.v4.app.Fragment;import android.support.v4.app.FragmentManager;import android.support.v4.app.FragmentPagerAdapter;import android.support.v4.view.ViewPager;import android.view.LayoutInflater;import android.view.View;import android.view.View.OnClickListener;import android.view.ViewGroup;import android.widget.Button;import android.widget.RadioGroup;import android.widget.RadioGroup.OnCheckedChangeListener;import com.bgood.xn.R;import com.bgood.xn.adapter.FragmentViewPagerAdapter;import com.bgood.xn.system.BGApp;import com.bgood.xn.ui.base.BaseFragment;import com.bgood.xn.ui.message.fragment.ChatHistoryFragment;import com.bgood.xn.ui.message.fragment.CommunicateFragment;import com.bgood.xn.ui.message.fragment.FriendListFragment;import com.bgood.xn.ui.message.fragment.GroupFragment;import com.bgood.xn.ui.user.account.LoginActivity;/** * @todo:聊天主界面 * @author:hg_liuzl@163.com */public class MessageFragment extends BaseFragment implements OnCheckedChangeListener,OnClickListener {		/**登录操作码**/	private static final int CODE_LOGIN = 100;		public static final int MESSAGE_MAIN = 0;	public static final int MESSAGE_FRIEND = 1;	public static final int MESSAGE_GROUP = 2;	public static final int MESSAGE_COMMUNICATION_HALL = 3;		private int messageCheckType = 0;	private RadioGroup radioGroup;	private Button btnAdd;	private ViewPager mTabPager;//页卡内容		private ArrayList<Fragment> fragmentList;	private int index;	// 当前fragment的index	private int currentTabIndex;		@Override	public View onCreateView(LayoutInflater inflater, ViewGroup container,Bundle savedInstanceState) {		layout = inflater.inflate(R.layout.layout_message_main, container, false);		return layout;	}			@Override	public void onResume() {		super.onResume();		if(BGApp.isUserLogin ){			initViews();		}else{			Intent intent = new Intent(mActivity, LoginActivity.class);			intent.putExtra(LoginActivity.FROM_KEY, LoginActivity.FROM_KEY_OTHER);			mActivity.startActivityForResult(intent, CODE_LOGIN);		}	}		@Override	public void onActivityResult(int requestCode, int resultCode, Intent data) {		super.onActivityResult(requestCode, resultCode, data);		if(resultCode == Activity.RESULT_OK && requestCode == CODE_LOGIN){			initViews();		}	}		/**	 * 初始化tabhost	 */	private void initViews()	{		btnAdd = (Button) layout.findViewById(R.id.b_message_main_add);		btnAdd.setOnClickListener(this);		radioGroup = (RadioGroup) layout.findViewById(R.id.rg_message_main_tab);		radioGroup.setOnCheckedChangeListener(this);		initPaper();	}				private void initPaper() {		mTabPager = (ViewPager)layout.findViewById(R.id.fragment_paper);		fragmentList = new ArrayList<Fragment>();		fragmentList.add(new ChatHistoryFragment());		fragmentList.add(new FriendListFragment());		fragmentList.add(new GroupFragment());		fragmentList.add(new CommunicateFragment());	    FragmentViewPagerAdapter adapter = new FragmentViewPagerAdapter(this.getChildFragmentManager(), mTabPager,fragmentList);	}		@Override	public void onCheckedChanged(RadioGroup group, int checkedId)	{		switch (checkedId)		{		case R.id.message_main_tab_messagecenter:			messageCheckType = MESSAGE_MAIN;			btnAdd.setVisibility(View.INVISIBLE);			index = 0;			break;		case R.id.message_main_tab_friend:			messageCheckType = MESSAGE_FRIEND;			btnAdd.setVisibility(View.VISIBLE);			index = 1;			break;		case R.id.message_main_tab_group:			messageCheckType = MESSAGE_GROUP;			btnAdd.setVisibility(View.VISIBLE);			index = 2;			break;		case R.id.message_main_tab_communication_hall:			btnAdd.setVisibility(View.INVISIBLE);			messageCheckType = MESSAGE_COMMUNICATION_HALL;			index = 3;			break;		}		mTabPager.setCurrentItem(index);	}	@Override	public void onClick(View v) {				Intent intent = null;		switch (v.getId()) {		case R.id.b_message_main_add:						if(messageCheckType == MESSAGE_FRIEND){	//添加好友				intent = new Intent(mActivity,AddFriendActivity.class);				startActivity(intent);							}else if(messageCheckType == MESSAGE_GROUP){//添加群组				intent = new Intent(mActivity,AddGroupActivity.class);				startActivity(intent);			}			break;		default:			break;		}	}}